<style>
    /* Override the text color for the table */
    #orphanTable th, #orphanTable td {
        color: #333 !important; /* Dark gray text */
        background-color: #ffffff !important; /* White background for better readability */
    }

    /* Optional: Add zebra striping */
    #orphanTable tbody tr:nth-child(even) {
        background-color: #f9f9f9 !important; /* Light gray for even rows */
    }

    /* Add borders for better visibility */
    #orphanTable th, #orphanTable td {
        border: 1px solid #ddd !important;
    }

    /* Header Styling */
    #orphanTable th {
        background-color: #f1f1f1 !important;
        color: #333 !important;
        font-weight: bold;
    }
</style>


@model IEnumerable<AlMabarratDonationWebApp.Application.DTO.OrphanDto>
@{
    var sponsorshipRequestId = ViewBag.SponsorshipRequestId;
    var donorEmail = ViewBag.DonorEmail;
}

@{
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
    ViewBag.Title = "Select Orphans for Sponsorship";
    var nationalities = Model.Select(o => o.Nationality).Where(n => !string.IsNullOrWhiteSpace(n)).Distinct().OrderBy(n => n).ToList();
}

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
}

<h2 class="mt-3 mb-4 text-lg font-bold">Select Orphans for Sponsorship</h2>


<p>Total Orphans: @Model.Count()</p>
@if (@Model.Count() == 0)
{
    <p style="color:red;">The list is empty, data is not fetched correctly.</p>
}

<form id="assignForm" method="post" asp-controller="Sponsorship" asp-action="AssignOrphans">
    <input type="hidden" name="SponsorshipRequestId" value="@sponsorshipRequestId" />
    <input type="hidden" name="DonorEmail" value="@donorEmail" />
    <div class="card custom-table-container">
        <div class="card-body">
            <div class="table-responsive">
                <table id="orphanTable" >
                    <thead>
                        <tr>
                            <th>Select</th>
                            <th>Full Name</th>
                            <th>Date of Birth</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Lost Parents</th>
                            <th>Status</th>
                            <th>Date Joined</th>
                            <th>Father's Name</th>
                            <th>Mother's Name</th>
                            <th>Nationality</th>
                            <th>Health</th>
                            <th>Sponsorship Type</th>
                        </tr>
                    </thead>
                   <tbody>
    @foreach (var orphan in Model)
    {
        <tr>
            <td>
                <input type="checkbox" name="selectedOrphans" value="@orphan.OrphanID" />
            </td>
            <td>@orphan.FullName</td>
            <td>@orphan.DateOfBirth.ToShortDateString()</td>
            <td>@orphan.Gender</td>
            <td>@orphan.Age</td>
            <td>@orphan.LostParents</td>
            <td>
                <span class="badge @(orphan.Status == "Active" ? "bg-success" : "bg-warning")">
                    @orphan.Status
                </span>
            </td>
            <td>@orphan.DateJoined.ToShortDateString()</td>
            <td>@orphan.FatherName</td>
            <td>@orphan.MotherName</td>
            <td>@orphan.Nationality</td>
            <td>@orphan.HealthCondition</td>
            <td>@orphan.SponsorshipType</td>
        </tr>
    }
</tbody>

                </table>
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Submit Selected Orphan</button>
</form>

@section Scripts {
    <script>
        $(document).ready(function () {
            if ($.fn.DataTable.isDataTable('#orphansTable')) {
                $('#orphansTable').DataTable().destroy();
            }

            $('#orphansTable').DataTable({
                "columnDefs": [{ "orderable": false, "targets": [0] }],
                "deferRender": true,
                "responsive": true,
                "processing": true,
                "lengthMenu": [5, 10, 25, 50, 100],
                "pageLength": 5,
                "language": {
                    "lengthMenu": "Display _MENU_ Orphans",
                    "zeroRecords": "No Orphans Found",
                    "info": "Page _PAGE_ of _PAGES_",
                    "infoEmpty": "No data available",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "search": "🔎 Search:",
                    "paginate": {
                        "previous": "Previous",
                        "next": "Next",
                        "first": "First",
                        "last": "Last"
                    },
                    "processing": '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>'
                }
            });
        });
    </script>
}
